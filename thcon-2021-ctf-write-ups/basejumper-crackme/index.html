<!doctype html><html lang=en-us>
<head><title>
THCon21 - ELF X64 - BaseJumper CrackMe |
Cyxo's Tech Blog</title>
<meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1,viewport-fit=cover">
<meta name=description content="An ELF x64 reverse engineering challenge from THCon21
    ">
<meta property="og:title" content="THCon21 - ELF x64 - BaseJumper CrackMe">
<meta property="og:description" content="An ELF x64 reverse engineering challenge from THCon21">
<meta property="og:type" content="article">
<meta property="og:url" content="https://blog.cyxo.cf/thcon-2021-ctf-write-ups/basejumper-crackme/"><meta property="article:section" content="THCon-2021-CTF-Write-Ups">
<meta property="article:published_time" content="2021-06-14T16:29:01+02:00">
<meta property="article:modified_time" content="2021-06-14T16:29:01+02:00">
<meta name=twitter:card content="summary">
<meta name=twitter:title content="THCon21 - ELF x64 - BaseJumper CrackMe">
<meta name=twitter:description content="An ELF x64 reverse engineering challenge from THCon21">
<meta itemprop=name content="THCon21 - ELF x64 - BaseJumper CrackMe">
<meta itemprop=description content="An ELF x64 reverse engineering challenge from THCon21"><meta itemprop=datePublished content="2021-06-14T16:29:01+02:00">
<meta itemprop=dateModified content="2021-06-14T16:29:01+02:00">
<meta itemprop=wordCount content="513">
<meta itemprop=keywords content="reverse engineering,">
<link rel=canonical href=https://blog.cyxo.cf/thcon-2021-ctf-write-ups/basejumper-crackme/>
<link rel=icon type=image/png href=https://blog.cyxo.cf/image/favicon.ico>
<link rel=stylesheet href=/css/font-awesome.min.css>
<link rel=stylesheet href=/css/bulma.min.css>
<script src=/js/ramium.js></script>
<link rel=stylesheet href=/css/ramium.css>
<link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.css integrity=sha384-zB1R0rpPzHqg7Kpt0Aljp8JPLqbXI3bhnPWROx27a9N0Ll6ZP/+DiW/UqRcLbRjq crossorigin=anonymous>
<script defer src=https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.js integrity=sha384-y23I5Q6l+B6vatafAwxRu/0oK/79VlbSz7Q9aiSZUvyWYIYsd+qj+o24G5ZU2zJz crossorigin=anonymous></script>
<script defer src=https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/contrib/auto-render.min.js integrity=sha384-kWPLUVMOks5AQFrykwIup5lo0m3iMkkHrD0uJ4H5cjeGihAutqP0yW0J6dpFiVkI crossorigin=anonymous onload=renderMathInElement(document.body)></script>
</head>
<body><nav class="navbar is-dark" role=navigation aria-label="main navigation">
<div class=navbar-brand>
<a class=navbar-item href=/>
<strong>Cyxo's Tech Blog </strong>
</a>
<a role=button class="navbar-burger burger" aria-label=menu aria-expanded=false data-target=navbarBasicExample>
<span aria-hidden=true></span>
<span aria-hidden=true></span>
<span aria-hidden=true></span>
</a>
</div>
<div id=navbarBasicExample class=navbar-menu>
<div class=navbar-start>
<a class=navbar-item href=/>Home</a>
<div class="navbar-item has-dropdown is-hoverable">
<a class=navbar-link>This Blog</a>
<div class=navbar-dropdown>
<a class=navbar-item href=/tags/>All Tags</a>
<a class=navbar-item href=/sections/>All Sections</a>
<a class=navbar-item href=/posts/>All Posts</a>
</div>
</div>
<a class=navbar-item href=/author/>Author</a>
</div>
<div class=navbar-end>
<a class="navbar-item navgithub" href=https://github.com/Cyxo/ target=_blank>
<i class="fa fa-github fa-2x"></i>
</a>
</div>
</div>
</nav><div class="columns is-centered">
<div id=page-body class="column is-7">
<div class="content blog">
<h1>THCon21 - ELF X64 - BaseJumper CrackMe</h1>
<div id=infobar class="level is-mobile">
<div class=level-left>
<div class=level-item>
<p class="subtitle info date">Jun 14, 2021
</p>
</div>
<div class=level-item>
<p class="subtitle info">
3 mins read
</p>
</div>
</div>
<div class="level-right is-hidden-touch">
<div class=tags>
<a class="tag is-dark is-rounded" href=/tags/reverse-engineering>Reverse Engineering</a>
</div>
</div>
</div>
<div class="tags is-hidden-desktop">
<a class="tag is-dark is-rounded" href=/tags/reverse-engineering>Reverse engineering</a>
</div>
<div class=blog-text>
<p><a href=../>Go back to write-ups list</a></p>
<blockquote>
<p><strong>Category:</strong> Reverse</p>
<p><strong>Creator:</strong> Podalirius</p>
<p><strong>Description:</strong></p>
<p>Find the validation password.</p>
<p><strong>Attachments:</strong></p>
<ul>
<li><a href=/files/thcon21/elf_x64_basejumper_crackme.bin>elf_x64_basejumper_crackme.bin</a></li>
</ul>
</blockquote>
<h2 id=analysis>Analysis</h2>
<p>I opened this binary in IDA and jumped to the <code>main</code> function. After a <em>lot</em> of <code>char</code> variables definitions (which probably contain the flag encrypted in some way), we can see the user input verification part:</p>
<p><img src=/image/thcon21/input_verif.png alt="Verification input"></p>
<p>As we can see, it loops through the characters of <code>argv[1]</code> and <code>break</code> whenever a character doesn&rsquo;t match the condition.</p>
<p>From there, I could have tried to understand the condition, and I would probably have had to retrieve the value of all the variables defined at the top of the <code>main</code> function. But I was kinda lazy. So I went for a different yet interesting method: using <a href=https://valgrind.org/>valgrind</a>.</p>
<h2 id=valgrind>Valgrind</h2>
<p>Valgrind is a tool to analyze the performance of a program. One of its functionnality - callgrind - allows you to count how many instructions were run before the program exits. In our case, if we enter a correct character, the program will go through one more iteration of the loop, thus increasing the number of instructions run.</p>
<p>Using this idea, I made a little script to bruteforce the characters one by one using valgrind. This method can be used for any challenge that early-exits when checking a password char by char (with some change to the charset).</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-py data-lang=py><span style=color:#f92672>import</span> subprocess <span style=color:#66d9ef>as</span> sp
<span style=color:#f92672>import</span> re

<span style=color:#75715e># from string import printable</span>
printable <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;0123456789ABCDEF&#34;</span>
command <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;./elf_x64_basejumper_crackme.bin&#34;</span>

<span style=color:#66d9ef>def</span> <span style=color:#a6e22e>count_instructions</span>(command, password):
    <span style=color:#66d9ef>try</span>:
        print(sp<span style=color:#f92672>.</span>check_output([<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;valgrind --tool=callgrind --callgrind-out-file=/dev/null </span><span style=color:#e6db74>{</span>command<span style=color:#e6db74>}</span><span style=color:#e6db74> </span><span style=color:#e6db74>{</span>password<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>], stderr<span style=color:#f92672>=</span>sp<span style=color:#f92672>.</span>STDOUT, shell<span style=color:#f92672>=</span><span style=color:#66d9ef>True</span>))
    <span style=color:#66d9ef>except</span> <span style=color:#a6e22e>Exception</span> <span style=color:#66d9ef>as</span> e:
        result <span style=color:#f92672>=</span> e<span style=color:#f92672>.</span>output<span style=color:#f92672>.</span>decode()
        count <span style=color:#f92672>=</span> int(re<span style=color:#f92672>.</span>search(<span style=color:#e6db74>r</span><span style=color:#e6db74>&#34;Collected : (\d+)&#34;</span>, result)<span style=color:#f92672>.</span>group(<span style=color:#ae81ff>1</span>))
        <span style=color:#66d9ef>return</span> count

lastpassword <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;z&#34;</span>
password <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;&#34;</span>
<span style=color:#66d9ef>while</span> lastpassword <span style=color:#f92672>!=</span> password:
    lastpassword <span style=color:#f92672>=</span> password
    <span style=color:#75715e># &#34;z&#34; is not in the alphabet, so we use it to get the number of instructions for a password that is sure to fail</span>
    default_count <span style=color:#f92672>=</span> count_instructions(command, password<span style=color:#f92672>+</span><span style=color:#e6db74>&#34;z&#34;</span>)
    <span style=color:#66d9ef>for</span> c <span style=color:#f92672>in</span> printable:
        count <span style=color:#f92672>=</span> count_instructions(command, password<span style=color:#f92672>+</span>c)
        <span style=color:#66d9ef>if</span> count <span style=color:#f92672>!=</span> default_count:
            password <span style=color:#f92672>=</span> password <span style=color:#f92672>+</span> c
            <span style=color:#66d9ef>break</span>
    print(password)

print(password)
</code></pre></div><p><em>Note: I guessed that the input would be uppercase hexadecimal after bruteforcing the 4 first characters (and considering it was the case for the previous chall from the same author). Reducing the alphabet from 100 to 16 highly sped up the bruteforce.</em></p>
<p>And here we can see it peacefully recovering the characters from the password.</p>
<p><img src=/image/thcon21/valgrind.gif alt=Valgrind></p>
<p>The final password is</p>
<pre tabindex=0><code>4B5A4357515244434749324853544B594F524A46474D4B4F4B5252464B564A544B4E4B4751534443495A484553563258474649464F564C494A5A53554B3342534A354C54533453574B5634454D564B46474646464D57425148553D3D3D3D3D3
</code></pre><p>so it took a bit of time to recover (the GIF twice the real speed).</p>
<h2 id=basejumping>Basejumping</h2>
<p>Now that we have this big hexadecimal string, it&rsquo;s time we get the flag. Once we decode the hexadecimal (base 16), we get another encoded string:</p>
<pre tabindex=0><code>KZCWQRDCGI2HSTKYORJFGMKOKRRFKVJTKNKGQSDCIZHESV2XGFIFOVLIJZSUK3BSJ5LTS4SWKV4EMVKFGFFFMWBQHU=====
</code></pre><p>Uppercase letters + numbers and 5 <code>=</code> of padding at the end, that is obviously base 32. Once decoded, we get:</p>
<pre tabindex=0><code>VEhDb24yMXtRS1NTbUU3SThHbFNIWW1PWUhNeEl2OW9rVUxFUE1JVX0=
</code></pre><p>Which looks a lot like base 64 and gives the flag once decoded:</p>
<pre tabindex=0><code>THCon21{QKSSmE7I8GlSHYmOYHMxIv9okULEPMIU}
</code></pre><p>To be honest, it took me a while to write the valgrind script, probably more than I would&rsquo;ve spent understanding the condition. But I&rsquo;m glad I did it, because this technique can be used for a lot of challenges, so now I have it ready.</p>
<p><a href=../>Go back to write-ups list</a></p>
</div>
</div><div id=social-media-share class=has-text-centered>
<p><i>Sharing is caring!</i></p>
<br>
<div class=share-buttons>
<a href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fblog.cyxo.cf%2fthcon-2021-ctf-write-ups%2fbasejumper-crackme%2f" onclick="return socialMediaPopUp(this.href,'',500,500),!1" title="Share on Facebook. Opens in a new window.">
<img src=/img/icons/45px/facebook.png>
</a>
<a href="https://twitter.com/intent/tweet?text=THCon21%20-%20ELF%20x64%20-%20BaseJumper%20CrackMe&url=https%3a%2f%2fblog.cyxo.cf%2fthcon-2021-ctf-write-ups%2fbasejumper-crackme%2f" onclick="return socialMediaPopUp(this.href,'',500,500),!1" title="Share on Twitter. Opens in a new window.">
<img src=/img/icons/45px/twitter.png>
</a>
<a href="http://www.reddit.com/submit?url=https%3a%2f%2fblog.cyxo.cf%2fthcon-2021-ctf-write-ups%2fbasejumper-crackme%2f" onclick="return socialMediaPopUp(this.href,'',900,500),!1" title="Share on Reddit. Opens in a new window.">
<img src=/img/icons/45px/reddit.png>
</a>
<a href="http://pinterest.com/pin/create/button/?url=https%3a%2f%2fblog.cyxo.cf%2fthcon-2021-ctf-write-ups%2fbasejumper-crackme%2f" onclick="return socialMediaPopUp(this.href,'',900,500),!1" title="Share on Pinterest. Opens in a new window.">
<img src=/img/icons/45px/pinterest.png>
</a>
<a href="http://www.tumblr.com/share/link?url=https%3a%2f%2fblog.cyxo.cf%2fthcon-2021-ctf-write-ups%2fbasejumper-crackme%2f" onclick="return socialMediaPopUp(this.href,'',900,500),!1" title="Share on Tumblr. Opens in a new window.">
<img src=/img/icons/45px/tumblr.png>
</a>
<a href="https://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2fblog.cyxo.cf%2fthcon-2021-ctf-write-ups%2fbasejumper-crackme%2f
			&title=THCon21%20-%20ELF%20x64%20-%20BaseJumper%20CrackMe&summary=Go%20back%20to%20write-ups%20list%0a%20Category%3a%20Reverse%0aCreator%3a%20Podalirius%0aDescription%3a%0aFind%20the%20validation%20password.%0aAttachments%3a%0a%20elf_x64_basejumper_crackme.bin%20%20%20Analysis%20I%20opened%20this%20binary%20in%20IDA%20and%20jumped%20to%20the%20main%20function.%20After%20a%20lot%20of%20char%20variables%20definitions%20%28which%20probably%20contain%20the%20flag%20encrypted%20in%20some%20way%29%2c%20we%20can%20see%20the%20user%20input%20verification%20part%3a&source=rafed123.github.io" onclick="return socialMediaPopUp(this.href,'',900,500),!1" title="Share on LinkedIn. Opens in a new window.">
<img src=/img/icons/45px/linkedin.png>
</a>
<a href="mailto:?subject=THCon21%20-%20ELF%20x64%20-%20BaseJumper%20CrackMe&body=Check out this site https%3a%2f%2fblog.cyxo.cf%2fthcon-2021-ctf-write-ups%2fbasejumper-crackme%2f" title="Share via Email. Opens in a new window.">
<img src=/img/icons/45px/mail.png>
</a>
</div>
</div>
<br>
<div id=disqus_thread></div>
<script type=text/javascript>(function(){var a,b;if(window.location.hostname=="localhost")return;a=document.createElement('script'),a.type='text/javascript',a.async=!0,b='',a.src='//'+b+'.disqus.com/embed.js',(document.getElementsByTagName('head')[0]||document.getElementsByTagName('body')[0]).appendChild(a)})()</script>
<noscript>Please enable JavaScript to view the <a href=http://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript>
</div>
</div>
<footer class="footer has-background-dark">
<div class="content has-text-centered has-text-white">
<p>
© 2020 Ramium. Powered by
<a class=has-text-light href=https://github.com/gohugoio/hugo target=_blank>
Hugo</a>. Theme
<a class=has-text-light href=https://github.com/rafed123/ramium/ target=_blank>
Ramium.
</a>
</p>
</div>
</footer>
</body>
</html>