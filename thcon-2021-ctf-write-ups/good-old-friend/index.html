<!doctype html><html lang=en-us><head><title>THCon21 - Good Old Friend |
My New Hugo Site</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,viewport-fit=cover"><meta name=description content="An Android reverse engineering challenge from THCon21
    "><meta property="og:title" content="THCon21 - Good old friend"><meta property="og:description" content="An Android reverse engineering challenge from THCon21"><meta property="og:type" content="article"><meta property="og:url" content="https://cyxo.github.io/thcon-2021-ctf-write-ups/good-old-friend/"><meta property="article:section" content="THCon-2021-CTF-Write-Ups"><meta property="article:published_time" content="2021-06-14T16:29:02+02:00"><meta property="article:modified_time" content="2021-06-14T16:29:02+02:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="THCon21 - Good old friend"><meta name=twitter:description content="An Android reverse engineering challenge from THCon21"><meta itemprop=name content="THCon21 - Good old friend"><meta itemprop=description content="An Android reverse engineering challenge from THCon21"><meta itemprop=datePublished content="2021-06-14T16:29:02+02:00"><meta itemprop=dateModified content="2021-06-14T16:29:02+02:00"><meta itemprop=wordCount content="389"><meta itemprop=keywords content="reverse engineering,android,"><link rel=canonical href=https://cyxo.github.io/thcon-2021-ctf-write-ups/good-old-friend/><link rel=icon type=image/png href=https://cyxo.github.io/image/favicon.ico><link rel=stylesheet href=/css/font-awesome.min.css><link rel=stylesheet href=/css/bulma.min.css><script src=/js/ramium.js></script><link rel=stylesheet href=/css/ramium.css><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.css integrity=sha384-zB1R0rpPzHqg7Kpt0Aljp8JPLqbXI3bhnPWROx27a9N0Ll6ZP/+DiW/UqRcLbRjq crossorigin=anonymous><script defer src=https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.js integrity=sha384-y23I5Q6l+B6vatafAwxRu/0oK/79VlbSz7Q9aiSZUvyWYIYsd+qj+o24G5ZU2zJz crossorigin=anonymous></script><script defer src=https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/contrib/auto-render.min.js integrity=sha384-kWPLUVMOks5AQFrykwIup5lo0m3iMkkHrD0uJ4H5cjeGihAutqP0yW0J6dpFiVkI crossorigin=anonymous onload=renderMathInElement(document.body)></script></head><body><nav class="navbar is-dark" role=navigation aria-label="main navigation"><div class=navbar-brand><a class=navbar-item href=/><strong>My New Hugo Site</strong></a>
<a role=button class="navbar-burger burger" aria-label=menu aria-expanded=false data-target=navbarBasicExample><span aria-hidden=true></span><span aria-hidden=true></span><span aria-hidden=true></span></a></div><div id=navbarBasicExample class=navbar-menu><div class=navbar-start><a class=navbar-item href=/>Home</a><div class="navbar-item has-dropdown is-hoverable"><a class=navbar-link>This Blog</a><div class=navbar-dropdown><a class=navbar-item href=/tags/>All Tags</a>
<a class=navbar-item href=/sections/>All Sections</a>
<a class=navbar-item href=/posts/>All Posts</a></div></div><a class=navbar-item href=/author/>Author</a></div><div class=navbar-end><a class="navbar-item navgithub" href=https://github.com/Cyxo/ target=_blank><i class="fa fa-github fa-2x"></i></a></div></div></nav><div class="columns is-centered"><div id=page-body class="column is-7"><div class="content blog"><h1>THCon21 - Good Old Friend</h1><div id=infobar class="level is-mobile"><div class=level-left><div class=level-item><p class="subtitle info date">Jun 14, 2021</p></div><div class=level-item><p class="subtitle info">2 mins read</p></div></div><div class="level-right is-hidden-touch"><div class=tags><a class="tag is-dark is-rounded" href=/tags/reverse-engineering>Reverse Engineering</a>
<a class="tag is-dark is-rounded" href=/tags/android>Android</a></div></div></div><div class="tags is-hidden-desktop"><a class="tag is-dark is-rounded" href=/tags/reverse-engineering>Reverse engineering</a>
<a class="tag is-dark is-rounded" href=/tags/android>Android</a></div><div class=blog-text><h1 id=thcon21---good-old-friend>THCon21 - Good old friend</h1><p><a href=../>Go back to write-ups list</a></p><blockquote><p><strong>Category:</strong> Reverse</p><p><strong>Creator:</strong> zephyr</p><p><strong>Description:</strong></p><p>Good old friend</p><p><strong>Attachments:</strong></p><ul><li><a href=/files/thcon21/goodOldFriend.apk>goodOldFriend.apk</a></li></ul></blockquote><h2 id=analysing-the-apk>Analysing the APK</h2><p>Android reverse engineering is by far my favorite subject. So let&rsquo;s dive right into the analysis.</p><p>I opened the APK file in a tool called JADX (the GUI version because I&rsquo;m a fake hacker who doesn&rsquo;t use a terminal and a keyboard only) and searched for a class that would be called MainActivity (which was very likely to be in the <code>party.thcon.y2021.level1</code> package).</p><p><em>Note: in case there are more Activities and classes, you should look for the <code>AndroidManifest.xml</code> file in the resources. Then search for the activity that has the intent <code>android.intent.category.LAUNCHER</code>. That&rsquo;s the activity launched when you click on the app&rsquo;s icon.</em></p><p>What caught my attention in the code was the loading of a native library (which includes a <code>checkInput</code> function).</p><p><img src=/image/thcon21/load_library.png alt="Native library loading"></p><p><em>The rest of the code in this activity checks whether the phone is rooted or not.</em></p><p>Using recursive search (Ctrl+Shift+F), I could find where <code>checkInput</code> is used, and it confirms that the function is called on the content of the password input on MainActivity.</p><p>We can find the native library in the resources, under the <code>lib</code> folder. I decided to extract the x86_64 one because it&rsquo;s easier to reverse.</p><h2 id=analysing-the-native-library>Analysing the native library</h2><p>I opened the .so file in IDA and filtered the functions list to find a function containing <code>checkInput</code>. Thus I found the function called</p><pre><code>Java_party_thcon_y2021_level1_MainActivity_checkInput
</code></pre><p>Here is the most interesting part (I renamed the variables for more clarity)</p><p><img src=/image/thcon21/native_aes.png alt="Native library code"></p><p>And here are the values of the 2 xmmwords and the encrypted_password unk:</p><p><img src=/image/thcon21/unks.png alt="Binary data"></p><p>So at first I thought I would just decrypt the password using the following parameters:</p><pre><code>key  = 3C4FCF098815F7ABA6D2AE2816157E2B
iv   = 000102030405060708090A0B0C0D0E0F
pass = E47BC2DFFAA645CB89A87780BB1619EF5DAA2AADF4CDA3EBD1884E64A2B43B68
</code></pre><p>But that didn&rsquo;t give me anything readable. Then my mate <a href=https://slowerzs.github.io/>@Slowerzs</a> who had the library opened in Ghidra had the idea that the pass, key or IV may be flipped. So we tried flipping them and the key and IV were indeed in the wrong byte order. Using these parameters, decrypting the pass gave us the flag</p><pre><code>key  = 2B7E151628AED2A6ABF7158809CF4F3C
iv   = 000102030405060708090A0B0C0D0E0F
flag = THCon21{C_1$_n3v3r_2_f@r}\x00\x00\x00\x00\x00\x00\x00
</code></pre><p><em>Note: the native library used for the AES encryption, called tiny-AES, does not support padding, which is why the flag was padded with null bytes.</em></p><p><a href=../>Go back to write-ups list</a></p></div></div><div id=social-media-share class=has-text-centered><p><i>Sharing is caring!</i></p><br><div class=share-buttons><a href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fcyxo.github.io%2fthcon-2021-ctf-write-ups%2fgood-old-friend%2f" onclick="return socialMediaPopUp(this.href,'',500,500),!1" title="Share on Facebook. Opens in a new window."><img src=/img/icons/45px/facebook.png></a>
<a href="https://twitter.com/intent/tweet?text=THCon21%20-%20Good%20old%20friend&url=https%3a%2f%2fcyxo.github.io%2fthcon-2021-ctf-write-ups%2fgood-old-friend%2f" onclick="return socialMediaPopUp(this.href,'',500,500),!1" title="Share on Twitter. Opens in a new window."><img src=/img/icons/45px/twitter.png></a>
<a href="http://www.reddit.com/submit?url=https%3a%2f%2fcyxo.github.io%2fthcon-2021-ctf-write-ups%2fgood-old-friend%2f" onclick="return socialMediaPopUp(this.href,'',900,500),!1" title="Share on Reddit. Opens in a new window."><img src=/img/icons/45px/reddit.png></a>
<a href="http://pinterest.com/pin/create/button/?url=https%3a%2f%2fcyxo.github.io%2fthcon-2021-ctf-write-ups%2fgood-old-friend%2f" onclick="return socialMediaPopUp(this.href,'',900,500),!1" title="Share on Pinterest. Opens in a new window."><img src=/img/icons/45px/pinterest.png></a>
<a href="http://www.tumblr.com/share/link?url=https%3a%2f%2fcyxo.github.io%2fthcon-2021-ctf-write-ups%2fgood-old-friend%2f" onclick="return socialMediaPopUp(this.href,'',900,500),!1" title="Share on Tumblr. Opens in a new window."><img src=/img/icons/45px/tumblr.png></a>
<a href="https://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2fcyxo.github.io%2fthcon-2021-ctf-write-ups%2fgood-old-friend%2f
			&title=THCon21%20-%20Good%20old%20friend&summary=THCon21%20-%20Good%20old%20friend%20Go%20back%20to%20write-ups%20list%0a%20Category%3a%20Reverse%0aCreator%3a%20zephyr%0aDescription%3a%0aGood%20old%20friend%0aAttachments%3a%0a%20goodOldFriend.apk%20%20%20Analysing%20the%20APK%20Android%20reverse%20engineering%20is%20by%20far%20my%20favorite%20subject.%20So%20let%26rsquo%3bs%20dive%20right%20into%20the%20analysis.&source=rafed123.github.io" onclick="return socialMediaPopUp(this.href,'',900,500),!1" title="Share on LinkedIn. Opens in a new window."><img src=/img/icons/45px/linkedin.png></a>
<a href="mailto:?subject=THCon21%20-%20Good%20old%20friend&body=Check out this site https%3a%2f%2fcyxo.github.io%2fthcon-2021-ctf-write-ups%2fgood-old-friend%2f" title="Share via Email. Opens in a new window."><img src=/img/icons/45px/mail.png></a></div></div><br><div id=disqus_thread></div><script type=text/javascript>(function(){var a,b;if(window.location.hostname=="localhost")return;a=document.createElement('script'),a.type='text/javascript',a.async=!0,b='',a.src='//'+b+'.disqus.com/embed.js',(document.getElementsByTagName('head')[0]||document.getElementsByTagName('body')[0]).appendChild(a)})()</script><noscript>Please enable JavaScript to view the <a href=http://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript></div></div><footer class="footer has-background-dark"><div class="content has-text-centered has-text-white"><p>© 2020 Ramium. Powered by
<a class=has-text-light href=https://github.com/gohugoio/hugo target=_blank>Hugo</a>. Theme
<a class=has-text-light href=https://github.com/rafed123/ramium/ target=_blank>Ramium.</a></p></div></footer></body></html>