<!doctype html><html lang=en-us><head><title>üá´üá∑ PWNME - Attack Equation Solving |
Cyxo's Tech Blog</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,viewport-fit=cover"><meta name=description content="Reverse (statique) d'un serveur Web en Go
    "><meta property="og:title" content="üá´üá∑ PWNME - Attack Equation Solving"><meta property="og:description" content="Reverse (statique) d'un serveur Web en Go"><meta property="og:type" content="article"><meta property="og:url" content="https://blog.cyxo.cf/pwnme-2022/attack-equation-solving/"><meta property="article:section" content="PWNME-2022"><meta property="article:published_time" content="2022-07-06T00:00:00+00:00"><meta property="article:modified_time" content="2022-07-06T00:00:00+00:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="üá´üá∑ PWNME - Attack Equation Solving"><meta name=twitter:description content="Reverse (statique) d'un serveur Web en Go"><meta itemprop=name content="üá´üá∑ PWNME - Attack Equation Solving"><meta itemprop=description content="Reverse (statique) d'un serveur Web en Go"><meta itemprop=datePublished content="2022-07-06T00:00:00+00:00"><meta itemprop=dateModified content="2022-07-06T00:00:00+00:00"><meta itemprop=wordCount content="534"><meta itemprop=keywords content="reverse engineering,"><link rel=canonical href=https://blog.cyxo.cf/pwnme-2022/attack-equation-solving/><link rel=icon type=image/png href=https://blog.cyxo.cf/image/favicon.ico><link rel=stylesheet href=/css/font-awesome.min.css><link rel=stylesheet href=/css/bulma.min.css><script src=/js/ramium.js></script>
<link rel=stylesheet href=/css/ramium.css><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.css integrity=sha384-zB1R0rpPzHqg7Kpt0Aljp8JPLqbXI3bhnPWROx27a9N0Ll6ZP/+DiW/UqRcLbRjq crossorigin=anonymous><script defer src=https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.js integrity=sha384-y23I5Q6l+B6vatafAwxRu/0oK/79VlbSz7Q9aiSZUvyWYIYsd+qj+o24G5ZU2zJz crossorigin=anonymous></script>
<script defer src=https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/contrib/auto-render.min.js integrity=sha384-kWPLUVMOks5AQFrykwIup5lo0m3iMkkHrD0uJ4H5cjeGihAutqP0yW0J6dpFiVkI crossorigin=anonymous onload=renderMathInElement(document.body)></script></head><body><nav class="navbar is-dark" role=navigation aria-label="main navigation"><div class=navbar-brand><a class=navbar-item href=/><strong>Cyxo's Tech Blog</strong></a>
<a role=button class="navbar-burger burger" aria-label=menu aria-expanded=false data-target=navbarBasicExample><span aria-hidden=true></span>
<span aria-hidden=true></span>
<span aria-hidden=true></span></a></div><div id=navbarBasicExample class=navbar-menu><div class=navbar-start><a class=navbar-item href=/>Home</a><div class="navbar-item has-dropdown is-hoverable"><a class=navbar-link>This Blog</a><div class=navbar-dropdown><a class=navbar-item href=/tags/>All Tags</a>
<a class=navbar-item href=/sections/>All Sections</a>
<a class=navbar-item href=/posts/>All Posts</a></div></div><a class=navbar-item href=/author/>Author</a></div><div class=navbar-end><a class=navbar-item title="RSS Feed" href=/index.xml target=_blank><i class="fa fa-rss-square fa-2x"></i></a>
<a class="navbar-item navgithub" title=Github href=https://github.com/Cyxo/ target=_blank><i class="fa fa-github fa-2x"></i></a></div></div></nav><div class="columns is-centered"><div id=page-body class="column is-7"><div class="content blog"><h1>üá´üá∑ PWNME - Attack Equation Solving</h1><div id=infobar class="level is-mobile"><div class=level-left><div class=level-item><p class="subtitle info date">Jul 6, 2022</p></div><div class=level-item><p class="subtitle info">3 mins read</p></div></div><div class="level-right is-hidden-touch"><div class=tags><a class="tag is-dark is-rounded" href=/tags/reverse-engineering>Reverse Engineering</a></div></div></div><div class="tags is-hidden-desktop"><a class="tag is-dark is-rounded" href=/tags/reverse-engineering>Reverse engineering</a></div><div class=blog-text><p><a href=../>Go back to write-ups list</a></p><p><em>This write-up is in French because it&rsquo;s a French CTF, sowwy</em></p><blockquote><p><strong>Category:</strong> Reverse</p><p><strong>Creator:</strong> Bryton</p><p><strong>Description:</strong></p><p>I love vir<strong>GIN</strong> tonic</p><p><em>Vous avez acc√®s au code compil√© du site web</em></p><p>Le flag est sous le format suivant: PWNME{flag}</p><p>ps: afin de valider le code sur le formulaire web il ne faut pas mettre PWNME{}.</p><p><a href=https://attack-equation-solving.pwnme.fr/>https://attack-equation-solving.pwnme.fr/</a></p><p><strong>Attachments:</strong></p><ul><li><a href=/files/pwnme22/attack_solving.rar>attack_solving.rar</a></li></ul></blockquote><p><em>Je sais que la solution la plus simple √©tait en dynamique, mais comme mon debugger ne fonctionnait pas, je vous propose une solution en statique.</em></p><p>Ce challenge est assez original puisque pour commencer il nous pr√©sente une interface web. Le binaire √† reverse est donc le serveur web de ce site.</p><p><img src=/image/pwnme22/aes_web.png alt="Page web"></p><p>Sans plus attendre, j&rsquo;ai ouvert le binaire dans mon d√©sassembleur pr√©f√©r√©. La premi√®re chose qu&rsquo;on remarque c&rsquo;est que le programme nous emm√®ne √† une fonction qui s&rsquo;appelle <code>main_main</code> (ou <code>main.main</code> selon le d√©sassembleur). On peut donc d√©j√† identifier qu&rsquo;il s&rsquo;agit d&rsquo;un binaire √©crit en Go (c&rsquo;est la s√©pcificit√© du Go). Un peu plus loin, on a la confirmation avec l&rsquo;appel √† une fonction comme <code>github_com_gin_gonic_gin___RouterGroup__handle</code> par exemple. En effet, les modules Go sont des repository Git et souvent distribu√©s via Github, donc il n&rsquo;est pas rare de retrouver &ldquo;github.com&rdquo; dans les programmes en Go.</p><p><img src=/image/pwnme22/aes_main.png alt="C&amp;rsquo;est du Go !"></p><p>On peut √©galement √† partir de ce nom de fonction se renseigner sur le fonctionnement <a href=https://github.com/gin-gonic/gin>Gin Gonic</a>, une librairie pour cr√©er un serveur web en Go. On peut notamment y voir que l&rsquo;appelle √† la fonction <code>RouterGroup.handle</code> prend en arguments une m√©thode HTTP (par exemple <code>"POST"</code>), un chemin dans l&rsquo;URL (par exemple <code>"/verify"</code>) et une ou plusieurs fonctions appel√©es &ldquo;handlers&rdquo; qui vont √™tre ex√©cut√© lorsqu&rsquo;on se rend sur cette URL.</p><p>L&rsquo;assembleur g√©n√©r√© par Go est vraiment simple et on peut facilement trouv√© les 3 arguments qui lui sont pass√©s. Et comme cet endpoint <code>/verify</code> nous permet de v√©rifier notre flag, on va s&rsquo;int√©resser √† son handler (ici sous le nom de <code>off_994D18</code>).</p><p><img src=/image/pwnme22/aes_handler.png alt="C&amp;rsquo;est du Go !"></p><p>Cette adresse pointe vers la fonction <code>main.verifyCode</code>, qui elle-m√™me appelle une autre fonction <code>main.IsValidCode</code>. On va donc s&rsquo;int√©resser plus en d√©tail √† cette derni√®re.</p><p>Une premi√®re partie appelle la fonction <code>main.GetAESKey</code> dont voici l&rsquo;algorithme :</p><p><img src=/image/pwnme22/aes_key.png alt="C&amp;rsquo;est du Go !"></p><p>Concr√®tement, on charge un tableau de bytes (√† partir des trois nombres hexad√©cimaux qu&rsquo;on voit ici) en m√©moire, puis sur chaque byte on soustrait 32 et on effectue un xor avec l&rsquo;index de la boucle. Enfin, le hash md5 de ce tableau est calcul√© et l&rsquo;hexad√©cimal de ce hash sera retourn√© comme cl√©.</p><p>La suite de <code>IsValidCode</code> charge une cha√Æne hexad√©cimale qui est d√©cod√©e et d√©chiffr√©e en AES ECB (d&rsquo;o√π le nom <strong>A</strong>ttack <strong>E</strong>quation <strong>S</strong>olving, j&rsquo;ai mis du temps √† comprendre). Si on veut faire un √©quivalent en Python de la fonction <code>IsValidCode</code>, on a donc :</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-py data-lang=py><span style=display:flex><span><span style=color:#f92672>from</span> binascii <span style=color:#f92672>import</span> unhexlify
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> Crypto.Cipher <span style=color:#f92672>import</span> AES
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> hashlib <span style=color:#f92672>import</span> md5
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># GetAESKey</span>
</span></span><span style=display:flex><span>key <span style=color:#f92672>=</span> list(
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>0x538D51947F538894</span><span style=color:#f92672>.</span>to_bytes(<span style=color:#ae81ff>8</span>, byteorder<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;little&#34;</span>) <span style=color:#f92672>+</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>0x538E8F8D7F93517F</span><span style=color:#f92672>.</span>to_bytes(<span style=color:#ae81ff>8</span>, byteorder<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;little&#34;</span>) <span style=color:#f92672>+</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>0x7F99</span><span style=color:#f92672>.</span>to_bytes(<span style=color:#ae81ff>2</span>, byteorder<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;little&#34;</span>)
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>for</span> i <span style=color:#f92672>in</span> range(<span style=color:#ae81ff>18</span>):
</span></span><span style=display:flex><span>    key[i] <span style=color:#f92672>-=</span> <span style=color:#ae81ff>32</span>
</span></span><span style=display:flex><span>    key[i] <span style=color:#f92672>^=</span> i
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>key <span style=color:#f92672>=</span> md5(bytes(key))<span style=color:#f92672>.</span>hexdigest()<span style=color:#f92672>.</span>encode()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Charge et d√©code l&#39;hexa</span>
</span></span><span style=display:flex><span>enc <span style=color:#f92672>=</span> unhexlify(<span style=color:#e6db74>&#34;59E2267F61917A7832D3608F6DDB2C6146E68ABBE82D0904CE10FE27BEBE4A54&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#75715e># Le d√©chiffre</span>
</span></span><span style=display:flex><span>cipher <span style=color:#f92672>=</span> AES<span style=color:#f92672>.</span>new(key, AES<span style=color:#f92672>.</span>MODE_ECB)
</span></span><span style=display:flex><span>text <span style=color:#f92672>=</span> cipher<span style=color:#f92672>.</span>decrypt(enc)
</span></span><span style=display:flex><span>print(text)
</span></span></code></pre></div><p>Et √† l&rsquo;arriv√©e, on obtient le clear text suivant :</p><pre tabindex=0><code>b&#39;pr0_cr4ck3r_g000\x10\x10\x10\x10\x10\x10\x10\x10\x10\x10\x10\x10\x10\x10\x10\x10&#39;
</code></pre><p>Qui permet bien de valider sur la page web !</p><p><img src=/image/pwnme22/aes_yay.png alt="Verification input"></p><p><a href=../>Go back to write-ups list</a></p></div></div><div id=social-media-share class=has-text-centered><p><i>Sharing is caring!</i></p><br><div class=share-buttons><a href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fblog.cyxo.cf%2fpwnme-2022%2fattack-equation-solving%2f" onclick='return socialMediaPopUp(this.href,"",500,500),!1' title="Share on Facebook. Opens in a new window."><img src=/img/icons/45px/facebook.png></a>
<a href="https://twitter.com/intent/tweet?text=%f0%9f%87%ab%f0%9f%87%b7%20PWNME%20-%20Attack%20Equation%20Solving&url=https%3a%2f%2fblog.cyxo.cf%2fpwnme-2022%2fattack-equation-solving%2f" onclick='return socialMediaPopUp(this.href,"",500,500),!1' title="Share on Twitter. Opens in a new window."><img src=/img/icons/45px/twitter.png></a>
<a href="http://www.reddit.com/submit?url=https%3a%2f%2fblog.cyxo.cf%2fpwnme-2022%2fattack-equation-solving%2f" onclick='return socialMediaPopUp(this.href,"",900,500),!1' title="Share on Reddit. Opens in a new window."><img src=/img/icons/45px/reddit.png></a>
<a href="http://pinterest.com/pin/create/button/?url=https%3a%2f%2fblog.cyxo.cf%2fpwnme-2022%2fattack-equation-solving%2f" onclick='return socialMediaPopUp(this.href,"",900,500),!1' title="Share on Pinterest. Opens in a new window."><img src=/img/icons/45px/pinterest.png></a>
<a href="http://www.tumblr.com/share/link?url=https%3a%2f%2fblog.cyxo.cf%2fpwnme-2022%2fattack-equation-solving%2f" onclick='return socialMediaPopUp(this.href,"",900,500),!1' title="Share on Tumblr. Opens in a new window."><img src=/img/icons/45px/tumblr.png></a>
<a href="https://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2fblog.cyxo.cf%2fpwnme-2022%2fattack-equation-solving%2f
			&title=%f0%9f%87%ab%f0%9f%87%b7%20PWNME%20-%20Attack%20Equation%20Solving&summary=Go%20back%20to%20write-ups%20list%0aThis%20write-up%20is%20in%20French%20because%20it%26rsquo%3bs%20a%20French%20CTF%2c%20sowwy%0aCategory%3a%20Reverse%0aCreator%3a%20Bryton%0aDescription%3a%0aI%20love%20virGIN%20tonic%0aVous%20avez%20acc%c3%a8s%20au%20code%20compil%c3%a9%20du%20site%20web%0aLe%20flag%20est%20sous%20le%20format%20suivant%3a%20PWNME%7bflag%7d&source=rafed123.github.io" onclick='return socialMediaPopUp(this.href,"",900,500),!1' title="Share on LinkedIn. Opens in a new window."><img src=/img/icons/45px/linkedin.png></a>
<a href="mailto:?subject=%f0%9f%87%ab%f0%9f%87%b7%20PWNME%20-%20Attack%20Equation%20Solving&body=Check out this site https%3a%2f%2fblog.cyxo.cf%2fpwnme-2022%2fattack-equation-solving%2f" title="Share via Email. Opens in a new window."><img src=/img/icons/45px/mail.png></a></div></div><br><div id=disqus_thread></div><script type=text/javascript>(function(){if(window.location.hostname=="localhost")return;var t,e=document.createElement("script");e.type="text/javascript",e.async=!0,t="",e.src="//"+t+".disqus.com/embed.js",(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(e)})()</script><noscript>Please enable JavaScript to view the <a href=http://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript></div></div><footer class="footer has-background-dark"><div class="content has-text-centered has-text-white"><p>¬© 2020 Ramium. Powered by
<a class=has-text-light href=https://github.com/gohugoio/hugo target=_blank>Hugo</a>. Theme
<a class=has-text-light href=https://github.com/rafed123/ramium/ target=_blank>Ramium.</a></p></div></footer></body></html>